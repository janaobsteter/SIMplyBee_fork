<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Variance calculations between individual and colony level values • SIMplyBee</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Variance calculations between individual and colony level values">
<meta property="og:description" content="SIMplyBee">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SIMplyBee</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question-circle"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-book"></span>
     
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/A_Introduction_to_honeybee_biology.html">Introduction to honeybee biology</a>
    </li>
    <li>
      <a href="../articles/C_Colony_events.html">Colony Events</a>
    </li>
    <li>
      <a href="../articles/B_Multiple_colonies.html">Multiple colonies</a>
    </li>
    <li>
      <a href="../articles/D_Crossing.html">Crossing</a>
    </li>
    <li>
      <a href="../articles/E_Genomics.html">Genomics</a>
    </li>
    <li>
      <a href="../articles/G_Sampling_functions.html">Sampling functions</a>
    </li>
    <li>
      <a href="../articles/F_Quantitative_Genetics.html">Quantitative Genetics</a>
    </li>
    <li>
      <a href="../articles/Z_FAQs.html">FAQs</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/HighlanderLab/SIMplyBee/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Variance calculations between individual and
colony level values</h1>
            
            <h4 data-toc-skip class="date">2023-12-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/HighlanderLab/SIMplyBee/blob/HEAD/vignettes/F2_Variance_calculations.Rmd" class="external-link"><code>vignettes/F2_Variance_calculations.Rmd</code></a></small>
      <div class="hidden name"><code>F2_Variance_calculations.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"SIMplyBee"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: AlphaSimR</span></span>
<span><span class="co">#&gt; Loading required package: R6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'SIMplyBee'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     split</span></span>
<span><span class="va">founderGenomes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://gaynorr.github.io/AlphaSimR/reference/quickHaplo.html" class="external-link">quickHaplo</a></span><span class="op">(</span>nInd <span class="op">=</span> <span class="fl">20</span>, nChr <span class="op">=</span> <span class="fl">16</span>, segSites <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">SP</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/SimParamBee.html">SimParamBee</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">founderGenomes</span><span class="op">)</span></span>
<span><span class="va">nQtlPerChr</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">mean</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">varA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">1.0</span>, <span class="op">-</span><span class="fl">0.5</span>, </span>
<span>                        <span class="op">-</span><span class="fl">0.5</span>,  <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">addTraitA</span><span class="op">(</span>nQtlPerChr <span class="op">=</span> <span class="va">nQtlPerChr</span>, mean <span class="op">=</span> <span class="va">mean</span>, var <span class="op">=</span> <span class="va">varA</span>, corA <span class="op">=</span> <span class="va">corA</span>,</span>
<span>             name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"queenTrait"</span>, <span class="st">"workersTrait"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">varE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span> <span class="op">/</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span><span class="op">)</span></span>
<span><span class="va">corE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.0</span>, <span class="fl">0.3</span>, </span>
<span>                        <span class="fl">0.3</span>, <span class="fl">1.0</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">2</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">SP</span><span class="op">$</span><span class="fu">setVarE</span><span class="op">(</span>varE <span class="op">=</span> <span class="va">varE</span>, corE <span class="op">=</span> <span class="va">corE</span><span class="op">)</span></span>
<span><span class="va">basePop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createVirginQueens</a></span><span class="op">(</span><span class="va">founderGenomes</span>, n <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">@</span><span class="va">gv</span><span class="op">)</span></span>
<span><span class="co">#&gt;      queenTrait workersTrait</span></span>
<span><span class="co">#&gt; [1,]  10.374412   0.18728236</span></span>
<span><span class="co">#&gt; [2,]   8.752311   0.20607206</span></span>
<span><span class="co">#&gt; [3,]   8.329824   0.10741918</span></span>
<span><span class="co">#&gt; [4,]  11.113384   0.07113577</span></span>
<span><span class="co">#&gt; [5,]  10.263743  -0.07755019</span></span>
<span><span class="co">#&gt; [6,]   9.884212  -0.01819165</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">@</span><span class="va">pheno</span><span class="op">)</span></span>
<span><span class="co">#&gt;      queenTrait workersTrait</span></span>
<span><span class="co">#&gt; [1,]  11.073654 -0.084868814</span></span>
<span><span class="co">#&gt; [2,]   8.311557  0.180908111</span></span>
<span><span class="co">#&gt; [3,]  11.243894  0.234128968</span></span>
<span><span class="co">#&gt; [4,]  13.074727 -0.001440822</span></span>
<span><span class="co">#&gt; [5,]   8.470487 -0.267213466</span></span>
<span><span class="co">#&gt; [6,]   8.783630  0.139829176</span></span>
<span><span class="va">drones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createDrones</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basePop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, nInd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createColony.html">createColony</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">basePop</span><span class="op">[</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">colony</span>, drones <span class="op">=</span> <span class="va">drones</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addCastePop.html">addWorkers</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">colony</span>, nInd <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="va">colony</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createMultiColony.html">createMultiColony</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">drones</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/createCastePop.html">createDrones</a></span><span class="op">(</span><span class="va">basePop</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, nInd <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">droneGroups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pullDroneGroupsFromDCA.html">pullDroneGroupsFromDCA</a></span><span class="op">(</span><span class="va">drones</span>, n <span class="op">=</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span>, nDrones <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross.html">cross</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">apiary</span>, drones <span class="op">=</span> <span class="va">droneGroups</span><span class="op">)</span></span>
<span><span class="va">apiary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/buildUp.html">buildUp</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="va">colonyGv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyGv</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="va">colonyPheno</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyPheno</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span></code></pre></div>
<p>The idea of this work is:</p>
<ol style="list-style-type: decimal">
<li><p>We want to do honey bee simulations with individual queens,
drones, and workers</p></li>
<li><p>To do the above, we require individual variances and
covariances</p></li>
<li><p>Literature reports only variances and covariances at the colony
level</p></li>
<li><p>The aim of this paper is to show how to use variances and
covariances at the colony level to do simulations at the individual
level.</p></li>
</ol>
<div class="section level2">
<h2 id="introduction-work-in-progress">Introduction WORK IN PROGRESS<a class="anchor" aria-label="anchor" href="#introduction-work-in-progress"></a>
</h2>
<p>This document develops theory for the variance of genetic and
phenotypic values between colonies with the aim to understand how to
fine tune a SIMplyBee simulation where we need variance components for
queen and workers effects at an individual honeybee level. The challenge
here is that in reality we do not observe such variances, but only on a
colony level.</p>
<p>For example, in the vignette we assumed that phenotypic variance on
the individual level is about 1/4 due to genetic variation and about 3/4
due to environmental variation, but looking at colony genetic and
phenotypic variances the ratio was aobut 1/2!</p>
<p>TODO: What do we do about this? It feels like we need a full paper on
all of this;) :(</p>
<p>INTRODUCTION</p>
<p>TODO: Topic 1</p>
<p>TODO: cite this paper that does honeybee simulations, but without
actually doing honeybee colony stuff etc. Heritability in honeybees
paper: <a href="https://agritrop.cirad.fr/599190/1/ece3.7389.pdf" class="external-link uri">https://agritrop.cirad.fr/599190/1/ece3.7389.pdf</a></p>
<p>TOOD: cite some classic papers on variances in honeybees</p>
<p>TODO: cite recent papers from German and Dutch colleagues on
variances in honeybees</p>
<p>Brascamp and Bijma (2014): Methods to estimate breeding values in
honey bees <a href="https://gsejournal.biomedcentral.com/articles/10.1186/s12711-014-0053-9" class="external-link uri">https://gsejournal.biomedcentral.com/articles/10.1186/s12711-014-0053-9</a></p>
<p>Brascamp and Bijma (2019): A note on genetic parameters and accuracy
of estimated breeding values in honey bees <a href="https://gsejournal.biomedcentral.com/articles/10.1186/s12711-019-0510-6" class="external-link uri">https://gsejournal.biomedcentral.com/articles/10.1186/s12711-019-0510-6</a></p>
<p>Andonov et al.: Modeling honey yield, defensive and swarming
behaviors of Italian honey bees (Apis mellifera ligustica) using
linear-threshold approaches <a href="https://doi.org/10.1186/s12863-019-0776-2" class="external-link uri">https://doi.org/10.1186/s12863-019-0776-2</a></p>
<p>To make use of the material in this document you should run the
quantitative genetics vignette - the first example. Then you can
continue here!</p>
<p>Having multiple colonies and their values, we can now return to the
“about” point mentioned at the start of this section, when we defined
quantitative genetic parameters. Recall that our starting quantitative
genetic parameters for the queen and workers effects were:</p>
<p>We will follow the example from Brascamp and Bijma (2019) they
have:</p>
<p><span class="math inline">\(\sigma_{g_q}^2=0.5\)</span> - this is
their <span class="math inline">\(\sigma_{A_q}^2=0.5\)</span></p>
<p><span class="math inline">\(\sigma_{g_w}^2=1.0\)</span> - this is
their <span class="math inline">\(\sigma_{A_w}^2=1.0\)</span> among
unrelated honeybees</p>
<p><span class="math inline">\(\sigma_{g_w}^2=0.32\)</span> - this is
their <span class="math inline">\(\sigma_{\bar{A}_w}^2=0.32\)</span>
among averages of groups of honeybees?</p>
<p><span class="math inline">\(\sigma_{{g_q},{g_w}}=-0.35\)</span></p>
<p><span class="math inline">\(\sigma_e^2=2.0\)</span></p>
<p><span class="math inline">\(h^2=(a_base\sigma_{g,w}^2 +
\sigma_{{g,w},{g,q}} \sigma_{g,q}^2)/\sigma_{p,c}^2=???\)</span></p>
<p><span class="math inline">\(h_w^2=a_base\sigma_{g,w}^2/\sigma_{p,c}^2=0.13\)</span></p>
<p><span class="math inline">\(h_q^2=\sigma_{g,q}^2/\sigma_{p,c}^2=0.20\)</span></p>
<p><span class="math inline">\(T^2=(sigma_{g,w}^2 +
2\sigma_{{g,w},{g,q}} \sigma_{g,q}^2)/\sigma_{p,c}^2=0.32\)</span></p>
<p><span class="math inline">\(T_w^2=\sigma_{g,w}^2/\sigma_{p,c}^2=0.41\)</span></p>
<p><span class="math inline">\(T_q^2=\sigma_{g,q}^2/\sigma_{p,c}^2=0.20\)</span></p>
<p><span class="math inline">\(r_g = cor(g_w, g_q) = -0.50\)</span></p>
<p>TODO: equation 3 in Brascamp and Bijma (2019) is highly relevant to
our work here - that equation shows connection between the variance of
the sum (or average) of worker genetic values for worker effect AND
variance of worker genetic values for worker effect - THIS IS WHAT WE
WORK WITH HERE SO WHAT IS NOVEL IN OUR WORK? I think its about providing
a tool and demonstrate it clearly. Also, they work with average, while
we work with the sum?</p>
<p>TODO: show sensitivity to the number of workers - the larger the
number of workers, the smaller the variance between workers</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trait means</span></span>
<span><span class="va">mean</span></span>
<span><span class="co">#&gt; [1] 10.0  0.1</span></span>
<span></span>
<span><span class="co"># Trait genetic variation - on a per honeybee level</span></span>
<span><span class="va">varA</span></span>
<span><span class="co">#&gt; [1] 1.00 0.01</span></span>
<span><span class="va">corA</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.0 -0.5</span></span>
<span><span class="co">#&gt; [2,] -0.5  1.0</span></span>
<span><span class="op">(</span><span class="va">covA</span> <span class="op">&lt;-</span> <span class="va">corA</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">varA</span><span class="op">)</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">varA</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       [,1]  [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.00 -0.05</span></span>
<span><span class="co">#&gt; [2,] -0.05  0.01</span></span>
<span></span>
<span><span class="co"># Trait environmental variation - on a per honeybee level</span></span>
<span><span class="va">varE</span></span>
<span><span class="co">#&gt; [1] 3.00 0.03</span></span>
<span><span class="va">corE</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.0  0.3</span></span>
<span><span class="co">#&gt; [2,]  0.3  1.0</span></span>
<span><span class="op">(</span><span class="va">covE</span> <span class="op">&lt;-</span> <span class="va">corE</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">varE</span><span class="op">)</span>, Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">varE</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="st">"*"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 3.00 0.09</span></span>
<span><span class="co">#&gt; [2,] 0.09 0.03</span></span>
<span></span>
<span><span class="co"># Trait phenotypic variation - on a per honeybee level</span></span>
<span><span class="op">(</span><span class="va">covP</span> <span class="op">&lt;-</span> <span class="va">covA</span> <span class="op">+</span> <span class="va">covE</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,] 4.00 0.04</span></span>
<span><span class="co">#&gt; [2,] 0.04 0.04</span></span>
<span><span class="op">(</span><span class="va">corP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov2cor</a></span><span class="op">(</span><span class="va">covP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]  1.0  0.1</span></span>
<span><span class="co">#&gt; [2,]  0.1  1.0</span></span>
<span><span class="op">(</span><span class="va">varP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">covP</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 4.00 0.04</span></span>
<span></span>
<span><span class="co"># Expected phenotypic variation - on a per colony level</span></span>
<span><span class="co"># TODO: there is in fact more stuff happening here - see below! </span></span>
<span><span class="va">nW</span> <span class="op">&lt;-</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span> <span class="co"># TODO: this is not correct - we have queen-workers pairs and workers-workers (see below!)</span></span>
<span><span class="co"># Var(z)=Var(x+y)=Var(x)+Var(sum(y))=Var(x)+Var(y_1)+Var(y_2)+...</span></span>
<span><span class="co"># this is all wrong likely ...</span></span>
<span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># just adding this so vignette can run, but I don't know what this k should be</span></span>
<span></span>
<span><span class="va">covA</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">covA</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">k</span> <span class="op">*</span> <span class="va">covA</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span> <span class="co"># variance can not be negative!</span></span>
<span><span class="co">#&gt; [1] 1.9</span></span>
<span><span class="va">covP</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">covP</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">k</span> <span class="op">*</span> <span class="va">covP</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 8.08</span></span>
<span></span>
<span><span class="co"># Observed variation - on a per colony level</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">colonyGv</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 18.49928</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">colonyPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 16.19401</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">colonyGv</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">colonyPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 1.142353</span></span></code></pre></div>
<p>Hmm, we have much higher genetic and phenotypic variances in
simulation than based simply looking at queen and n*workers variances,
as well as much higher ratio between the two than the initial value of
~1/4! Why? Let’s see. For genetic value of a colony <span class="math inline">\(g_c\)</span> we add up the queen’s genetic value
for the queen effect <span class="math inline">\(g_{q,q}\)</span> and
workers’ genetic values for the workers effect <span class="math inline">\(\Sigma_{i=1}^{n_w}(g_{i,w})\)</span>:</p>
<p><span class="math inline">\(g_c = g_{q,q} +
\Sigma_{i=1}^{n_w}(g_{i,w}).\)</span></p>
<p>Expectation of colony genetic value is then:</p>
<p><span class="math inline">\(E(g_c) = E(g_{q,q} +
\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span></p>
<p><span class="math inline">\(E(g_c) = E(g_{q,q}) +
E(\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span></p>
<p><span class="math inline">\(E(g_c) = \mu_{g_{q}} + n_w
E(g_{w,w})\)</span></p>
<p><span class="math inline">\(E(g_c) = \mu_{g_{q}} + n_w
\mu_{g_{w}}\)</span></p>
<p>we are assuming here that <span class="math inline">\(n_w\)</span> is
a fixed value, but if it is a random variable then we would have</p>
<p><span class="math inline">\(E(g_c) = \mu_{g_{q}} + E(n_w)
E(g_{w,w})\)</span> using <a href="https://en.wikipedia.org/wiki/Distribution_of_the_product_of_two_random_variables" class="external-link uri">https://en.wikipedia.org/wiki/Distribution_of_the_product_of_two_random_variables</a></p>
<p><span class="math inline">\(E(g_c) = \mu_{g_{q}} + \lambda_{n_w}
\mu_{g_{w}}\)</span></p>
<p>where <span class="math inline">\(\lambda_{n_w}\)</span> is average
number of workers. So, in our case this turns out the same as above. So
in our case we have:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nW</span> <span class="op">&lt;-</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span></span>
<span><span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 20</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">colonyGv</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20.29408</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">colonyPheno</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 20.68138</span></span></code></pre></div>
<p>Variance of colony genetic value is then:</p>
<p><span class="math inline">\(Var(g_c) = Var(g_{q,q} +
\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span></p>
<p><span class="math inline">\(Var(g_c) = Var(g_{q,q}) +
Var(\Sigma_{i=1}^{n_w}(g_{i,w})) + 2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span></p>
<p><span class="math inline">\(Var(g_c) = \sigma^2_{g_{q}} +
Var(\Sigma_{i=1}^{n_w}(g_{i,w})) + 2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span></p>
<p>So, we have three parts:</p>
<ol style="list-style-type: upper-alpha">
<li><p>the variance of the queen effect in queens <span class="math inline">\(\sigma^2_{g_{q}}\)</span>,</p></li>
<li><p>variance of a sum of workers effect in workers <span class="math inline">\(Var(\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span>,
and</p></li>
<li><p>covariance between the two <span class="math inline">\(2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span>.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="a-variance-of-the-queen-effect-in-queens-sigma2_g_q---in-our-case-this-is">A) Variance of the queen effect in queens <span class="math inline">\(\sigma^2_{g_{q}}\)</span> - in our case this
is:<a class="anchor" aria-label="anchor" href="#a-variance-of-the-queen-effect-in-queens-sigma2_g_q---in-our-case-this-is"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varA</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">apiary</span>, collapse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>, <span class="st">"queenTrait"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.082584</span></span>
<span><span class="co"># ... note that R's var() divides by n-1, which matters with small n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="../reference/getGv.html">getQueenGv</a></span><span class="op">(</span><span class="va">apiary</span>, collapse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[</span>, <span class="st">"queenTrait"</span><span class="op">]</span> <span class="op">-</span> <span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1.013643</span></span></code></pre></div>
<p>Anyway, quite close!</p>
</div>
<div class="section level2">
<h2 id="b-variance-of-a-sum-of-workers-effect-in-workers-varsigma_i1n_wg_iw">B) Variance of a sum of workers effect in workers <span class="math inline">\(Var(\Sigma_{i=1}^{n_w}(g_{i,w}))\)</span><a class="anchor" aria-label="anchor" href="#b-variance-of-a-sum-of-workers-effect-in-workers-varsigma_i1n_wg_iw"></a>
</h2>
<p>Given that this is a sum, we need to look at:</p>
<p>B1) variance of each of worker genetic values <span class="math inline">\(Var(g_{i,w})\)</span> and</p>
<p>B2) covariance between each pair of the values <span class="math inline">\(Cov(g_{i,w}, g_{j,w})\)</span>.</p>
<p>This means, that family structure will start to matter because it
induces covariance between family members (workers). The simplest case
is when all workers come from the same father. Then we have:</p>
<p><span class="math inline">\(g_{1,w} = \frac{1}{2}g_{q,w} + g_{f,w} +
r_{1,w}\)</span></p>
<p><span class="math inline">\(g_{2,w} = \frac{1}{2}g_{q,w} + g_{f,w} +
r_{2,w}\)</span></p>
<p>…</p>
<p><span class="math inline">\(g_{n_w,w} = \frac{1}{2}g_{q,w} + g_{f,w}
+ r_{n_w,w}\)</span></p>
<div class="section level3">
<h3 id="b1-variance-of-each-of-worker-genetic-values-varg_iw">B1) variance of each of worker genetic values <span class="math inline">\(Var(g_{i,w})\)</span><a class="anchor" aria-label="anchor" href="#b1-variance-of-each-of-worker-genetic-values-varg_iw"></a>
</h3>
<p>As stated initially, we have <span class="math inline">\(Var(g_{i,w})
= \sigma^2_{g_{w}}\)</span> and we have <span class="math inline">\(n_w\)</span> such terms, <span class="math inline">\(n_w \sigma^2_{g_{w}}\)</span>. In our case this
would be:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nW</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyGv</a></span><span class="op">(</span><span class="va">apiary</span>, <span class="va">mapCasteToColonyGv</span>, queenTrait <span class="op">=</span> <span class="cn">NULL</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="co">#&gt;              workersTrait</span></span>
<span><span class="co">#&gt; workersTrait     26.47835</span></span>
<span><span class="co"># ... note that R's var() divides by n-1, which matters with small n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">g</span> <span class="op">-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 24.62804</span></span></code></pre></div>
<p>So, a huge discrepancy between the variance of a sum of genetic
values for the workers effect <code>nW * varA[2]</code> (assuming
independence) and a realised sum of genetic values for the workers
effect. As we have seen above, this is due to family structure and
associated B2) covariance between each pair of the values <span class="math inline">\(Cov(g_{i,w}, g_{j,w})\)</span>.</p>
</div>
<div class="section level3">
<h3 id="b2-covariance-between-each-pair-of-the-values-covg_iw-g_jw">B2) covariance between each pair of the values <span class="math inline">\(Cov(g_{i,w}, g_{j,w})\)</span><a class="anchor" aria-label="anchor" href="#b2-covariance-between-each-pair-of-the-values-covg_iw-g_jw"></a>
</h3>
<p>Clearly, these covariances matter a lot - there is lots of worker
pairs in a colony! How do these covariances look like?</p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
Cov(\frac{1}{2}g_{q,w} + g_{f,w}, \frac{1}{2}g_{q,w} +
g_{f,w})\)</span></p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
Var(\frac{1}{2}g_{q,w}) + Var(g_{f,w})\)</span></p>
<p>assuming that mother and father are not related; further genetic
variance between drones is in fact half the genetic variance between
queens because they are haploid, so we get:</p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
\frac{1}{4}\sigma^2_{g_w} + \frac{1}{4}\sigma^2_{g_w}\)</span></p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
\frac{1}{2}\sigma^2_{g_w}\)</span>.</p>
<p>Every pair of super-sister workers adds <span class="math inline">\(\frac{1}{2}\sigma^2_{g_w}\)</span> to B - note
that pair A-B adds this value, but so does the pair B-A, hence total is
<span class="math inline">\(2\frac{1}{2}\sigma^2_{g_w} =
\sigma^2_{g_w}\)</span>. With <span class="math inline">\(n_w\)</span>
workers we get <span class="math inline">\(n_w n_w\)</span> pairs
(including with itself) or <span class="math inline">\(n_w n_w -
n_w\)</span> pairs between different workers. The total covariance
contribution is then <span class="math inline">\((n_w n_w -
n_w)\frac{1}{2}\sigma^2_{g_w}\)</span>). In our case this would be:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B1</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="op">(</span><span class="va">covSumWorkers</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">-</span> <span class="va">nW</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2</span></span>
<span><span class="co">#&gt; [1] 49.5</span></span>
<span><span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covSumWorkers</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 50.5</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyGv</a></span><span class="op">(</span><span class="va">apiary</span>, <span class="va">mapCasteToColonyGv</span>, queenTrait <span class="op">=</span> <span class="cn">NULL</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt;              workersTrait</span></span>
<span><span class="co">#&gt; workersTrait     26.47835</span></span>
<span><span class="co"># ... note that R's var() divides by n-1, which matters with small n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">g</span> <span class="op">-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 24.62804</span></span></code></pre></div>
<p>If we would only have super-sisters we would have ~1 for B1, ~49.5
for B2, and ~50.5 for B, but with a mix of half-sisters and
super-sisters we would have a lower value, which is what we see above,
~26.8 for B.</p>
<p>TODO: Define the setting above in intro or start of M&amp;M - We also
can have full-sisters, where the mother is obviously the same, but the
fathers are different, yet they come from the same mother, which is
equivalent to a full-sibs case in diploid species. We will assume in
this work that we have unrelated queens and unrelated drones (=base pop)
- our aim is to set variances in such a base population - to get the
scale or the variances right. In simulation of our base population we
generated drones from virgin queens, which means that our drones can in
fact be brothers, so our realised variances might be a bit off compared
to this theory. But this is fine, we are mostly trying to get the order
of variances correct.</p>
<p>So, now we need to work out B2 with a mix of half-sisters and
super-sisters :( Sister workers are related only due to having the same
mother, assuming that drones the queen mated with are unrelated:</p>
<p><span class="math inline">\(g_{1,w} = \frac{1}{2}g_{q,w} + g_{f1,w} +
r_{1,w}\)</span></p>
<p><span class="math inline">\(g_{2,w} = \frac{1}{2}g_{q,w} + g_{f2,w} +
r_{2,w}\)</span></p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
Cov(\frac{1}{2}g_{q,w} + g_{f1,w}, \frac{1}{2}g_{q,w} +
g_{f2,w})\)</span></p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
Var(\frac{1}{2}g_{q,w})\)</span></p>
<p><span class="math inline">\(Cov(g_{1,w}, g_{2,w}) =
\frac{1}{4}Var(g_{q,w})\)</span></p>
<p>Hence every pair of half-sister workers adds <span class="math inline">\(\frac{1}{4}\sigma^2_{g_w}\)</span> to B (note,
this is <span class="math inline">\(2\frac{1}{4}\sigma^2_{g_w}\)</span>
for A-B and B-A pairs!). With <span class="math inline">\(n_w\)</span>
workers and <span class="math inline">\(n_f\)</span> fathers we have
<span class="math inline">\(\frac{n_w}{n_f}\)</span> workers per father.
Further, we have <span class="math inline">\(n_f\)</span> groups of
super-sisters and <span class="math inline">\(n_f n_f - n_f\)</span>
pairs of sister groups. Assuming that half-sister groups are the same
size, we have <span class="math inline">\(n_f \frac{n_w}{n_f}
\frac{n_w}{n_f} = n_w \frac{n_w}{n_f} = \frac{n^2_w}{n_f}\)</span> pairs
of super-sisters and <span class="math inline">\((n_f n_f - n_f)
\frac{n_w}{n_f} \frac{n_w}{n_f}\)</span> - this is <span class="math inline">\(n_f (n_f - 1) \frac{n_w}{n_f} \frac{n_w}{n_f} =
(n_f - 1) n_w \frac{n_w}{n_f} = \frac{ (n_f - 1) n^2_w}{n_f}\)</span>.
Is this correct?</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">nF</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nCaste.html">nFathers</a></span><span class="op">(</span><span class="va">colony</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 15</span></span>
<span><span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span></span>
<span><span class="co">#&gt; [1] 10000</span></span>
<span><span class="op">(</span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 666.6667</span></span>
<span><span class="op">(</span><span class="va">b</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nF</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 9333.333</span></span>
<span><span class="va">a</span><span class="op">+</span><span class="va">b</span> </span>
<span><span class="co">#&gt; [1] 10000</span></span></code></pre></div>
<p>Looks like!</p>
<p>So, super-sister pairs add <span class="math inline">\(\frac{n^2_w}{n_f}
\frac{1}{2}\sigma^2_{g_w}\)</span> and half-sister pairs add <span class="math inline">\(\frac{ (n_f - 1) n^2_w}{n_f}
\frac{1}{4}\sigma^2_{g_w}\)</span>. Let’s test this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B1</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersSuperSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.50</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in super-sisters</span></span>
<span><span class="co">#&gt; [1] 3.333333</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersHalfSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">nF</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in half-sisters</span></span>
<span><span class="co">#&gt; [1] 23.33333</span></span>
<span><span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covSumWorkersSuperSisters</span> <span class="op">+</span> <span class="va">covSumWorkersHalfSisters</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 27.66667</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calcColonyValue.html">calcColonyGv</a></span><span class="op">(</span><span class="va">apiary</span>, <span class="va">mapCasteToColonyGv</span>, queenTrait <span class="op">=</span> <span class="cn">NULL</span>, workersTrait <span class="op">=</span> <span class="st">"workersTrait"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt;              workersTrait</span></span>
<span><span class="co">#&gt; workersTrait     26.47835</span></span>
<span><span class="co"># ... note that R's var() divides by n-1, which matters with small n</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">g</span> <span class="op">-</span> <span class="va">SP</span><span class="op">$</span><span class="va">nWorkers</span> <span class="op">*</span> <span class="va">mean</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 24.62804</span></span></code></pre></div>
<p>Cool - very close!!! There can be some difference because the
formulae above assume that we have fixed sizes of half-sister and
super-sister groups. Also, there can be full-sisters in there as
well!!!</p>
<p>TODO: We could also add full-sisters: To do this, we would have to
assume how many brother drones we use to figure out the grups</p>
<p>TODO: What if <span class="math inline">\(n_w\)</span> is a random
variable? Following <a href="https://en.wikipedia.org/wiki/Distribution_of_the_product_of_two_random_variables" class="external-link uri">https://en.wikipedia.org/wiki/Distribution_of_the_product_of_two_random_variables</a>
we would use:</p>
<p><span class="math inline">\(Var(XY) = (Var(X) + E(X)^2) (Var(Y) +
E(Y)^2) - E(X)^2 E(Y)^2\)</span></p>
<p>but this is for two variables, while I have <span class="math inline">\(n_w\)</span> genetic values, so this reference
result is not that useful in our case! Well, if <span class="math inline">\(n_w\)</span> varies between colonies, this must
boost variance of colony-level genetic values significantly, because
kind of start calculating variance between apples (small colonies) and
oranges (large colonies).</p>
</div>
</div>
<div class="section level2">
<h2 id="c-covariance-between-the-two-2covg_qq-sigma_i-1n_wg_iw-">C) Covariance between the two <span class="math inline">\(2Cov(g_{q,q},
\Sigma_{i-1}^{n_w}(g_{i,w}))\)</span>.<a class="anchor" aria-label="anchor" href="#c-covariance-between-the-two-2covg_qq-sigma_i-1n_wg_iw-"></a>
</h2>
<p>Let’s repeat:</p>
<p><span class="math inline">\(g_{1,w} = \frac{1}{2}g_{q,w} + g_{f1,w} +
r_{1,w}\)</span></p>
<p><span class="math inline">\(g_{2,w} = \frac{1}{2}g_{q,w} + g_{f2,w} +
r_{2,w}\)</span> …</p>
<p>The essential bit here is:</p>
<p><span class="math inline">\(Cov(g_{q,q}, g_{i,w}) = Cov(g_{q,q},
\frac{1}{2} g_{q,w})\)</span></p>
<p>assuming that the queen and fathers are unrelated. Then:</p>
<p><span class="math inline">\(Cov(g_{q,q}, g_{i,w}) = Cov(g_{q},
\frac{1}{2} g_{w})\)</span></p>
<p><span class="math inline">\(Cov(g_{q,q}, g_{i,w}) = \frac{1}{2}
Cov(g_{q}, g_{w})\)</span></p>
<p><span class="math inline">\(Cov(g_{q,q}, g_{i,w}) = \frac{1}{2}
\sigma_{g_{q},g_{w}}\)</span></p>
<p>So:</p>
<p><span class="math inline">\(2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w})) = 2Cov(g_{q,q}, n_w \frac{1}{2}
g_{q,w})\)</span></p>
<p><span class="math inline">\(2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w})) = 2 n_w \frac{1}{2}Cov(g_{q,q},
g_{q,w})\)</span></p>
<p><span class="math inline">\(2Cov(g_{q,q},
\Sigma_{i=1}^{n_w}(g_{i,w})) = n_w \sigma_{g_{q},g_{w}}\)</span></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">varQueen</span> <span class="op">&lt;-</span> <span class="va">varA</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># A</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B1</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersSuperSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.50</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in super-sisters</span></span>
<span><span class="co">#&gt; [1] 3.333333</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersHalfSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">nF</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in half-sisters</span></span>
<span><span class="co">#&gt; [1] 23.33333</span></span>
<span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covSumWorkersSuperSisters</span> <span class="op">+</span> <span class="va">covSumWorkersHalfSisters</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 27.66667</span></span>
<span></span>
<span><span class="op">(</span><span class="va">covQueenSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">covA</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># C</span></span>
<span><span class="co">#&gt; [1] -5</span></span>
<span></span>
<span><span class="va">varQueen</span> <span class="op">+</span> <span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covQueenSumWorkers</span></span>
<span><span class="co">#&gt; [1] 23.66667</span></span>
<span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="va">colonyGv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 18.49928</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">g</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 17.26438</span></span>
<span></span>
<span></span>
<span><span class="op">(</span><span class="va">varQueen</span> <span class="op">&lt;-</span> <span class="va">varP</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="co"># A</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">varP</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B1</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersSuperSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.50</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in super-sisters - only genetic cov here, I think TODO!?</span></span>
<span><span class="co">#&gt; [1] 3.333333</span></span>
<span><span class="op">(</span><span class="va">covSumWorkersSisters</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">nF</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">nW</span> <span class="op">/</span> <span class="va">nF</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.25</span> <span class="op">*</span> <span class="va">varA</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># B2 in sisters - only genetic cov here, I think TODO!?</span></span>
<span><span class="co">#&gt; [1] 23.33333</span></span>
<span><span class="op">(</span><span class="va">varSumWorkers</span> <span class="op">&lt;-</span> <span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covSumWorkersSuperSisters</span> <span class="op">+</span> <span class="va">covSumWorkersSisters</span><span class="op">)</span> <span class="co"># B</span></span>
<span><span class="co">#&gt; [1] 30.66667</span></span>
<span></span>
<span><span class="op">(</span><span class="va">covQueenSumWorkers</span> <span class="op">&lt;-</span> <span class="va">nW</span> <span class="op">*</span> <span class="va">covP</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="co"># C - pheno or genetic only here - TODO!?</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span></span>
<span><span class="va">varQueen</span> <span class="op">+</span> <span class="va">varSumWorkers</span> <span class="op">+</span> <span class="va">covQueenSumWorkers</span></span>
<span><span class="co">#&gt; [1] 38.66667</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">colonyPheno</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 16.19401</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">p</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="../reference/nColonies.html">nColonies</a></span><span class="op">(</span><span class="va">apiary</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 15.50157</span></span></code></pre></div>
<p>Bingo for genetic variance and very close for phenotypic too, but we
need to check some part above!</p>
</div>
<div class="section level2">
<h2 id="what-now">What now?<a class="anchor" aria-label="anchor" href="#what-now"></a>
</h2>
<p>Alright, what can we now do with this? We now have a system of
expected genetic and phenotypic variances for colony values as a
function of number of workers, fathers, and genetic and phenotypic
covariances between the queen and worker effects. So, it should be
possible, in principle, to solve for what kind of covariance values for
the queen and workers effects should we use, to get the desired colony
genetic and phenotypic variances!</p>
<p>TODO: develop such estimating equations!</p>
<p>So, we have genetic part:</p>
<p><span class="math inline">\(A_g = \sigma^2_{g_q}\)</span></p>
<p><span class="math inline">\(B1_g = n_w \sigma^2_{g_w}\)</span></p>
<p><span class="math inline">\(B2_g = \frac{n^2_w}{n_f} \frac{1}{2}
\sigma^2_{g_w}\)</span></p>
<p><span class="math inline">\(B3_g = \frac{(n_f - 1) n^2_w}{n_f}
\frac{1}{4} \sigma^2_{g_w}\)</span></p>
<p><span class="math inline">\(C_g = n_w
\sigma^2_{{g_q},{g_w}}\)</span></p>
<p>here are 3 unknowns: <span class="math inline">\(\sigma^2_{g_q}\)</span>, <span class="math inline">\(\sigma^2_{g_w}\)</span>, and <span class="math inline">\(\sigma^2_{{g_q},{g_w}}\)</span></p>
<p>we can add phenotypic part:</p>
<p><span class="math inline">\(A_p = \sigma^2_{p_q}\)</span></p>
<p><span class="math inline">\(B1_p = n_w \sigma^2_{p_w}\)</span></p>
<p><span class="math inline">\(B2_p = \frac{n^2_w}{n_f} \frac{1}{2}
\sigma^2_{g_w}\)</span> TODO: check if its only genetic</p>
<p><span class="math inline">\(B3_p = \frac{(n_f - 1) n^2_w}{n_f}
\frac{1}{4} \sigma^2_{g_w}\)</span> TODO: check if its only genetic</p>
<p><span class="math inline">\(C_p = n_w
\sigma^2_{{p_q},{p_w}}\)</span></p>
<p>here are additional 3 unknowns: <span class="math inline">\(\sigma^2_{p_q}\)</span>, <span class="math inline">\(\sigma^2_{p_w}\)</span>, and <span class="math inline">\(\sigma^2_{{p_q},{p_w}}\)</span></p>
<p>while we could provide as guidance 2, maybe 3, inputs: <span class="math inline">\(\sigma^2_{g_c}\)</span>, <span class="math inline">\(\sigma^2_{p_c}\)</span>, and <span class="math inline">\(\frac{\sigma^2_{g_c}}{\sigma^2_{p_c}}\)</span>.</p>
<p>TODO: are there any additional inputs that we could get from
literature? How do we connect all this with variance estimates for the
queen and the workers effect in the honeybee genetics and breeding
literature? I think that those estimates are essentially this: <span class="math inline">\(\sigma^2_{g_c} = \sigma^2_{g_{c,q}} +
\sigma^2_{g_{c,w}} + 2\sigma_{g_{c,q},g_{c,w}}\)</span> where <span class="math inline">\(\sigma^2_{g_{c,q}}\)</span> is the queen part of
<span class="math inline">\(\sigma^2_{g_c}\)</span>, but not necessarily
the same as <span class="math inline">\(\sigma^2_{g_w}\)</span>, or is
it? Maybe that is the same, and <span class="math inline">\(\sigma^2_{g_{c,w}}\)</span> is a counterpart to
<span class="math inline">\(n_w \sigma^2_{g_w} + \frac{n^2_w}{n_f}
\frac{1}{2} \sigma^2_{g_w}, \frac{(n_f - 1) n^2_w}{n_f} \frac{1}{4}
\sigma^2_{g_w}\)</span> (TODO: should we add full-sisters?), while <span class="math inline">\(\sigma_{g_{c,q},g_{c,w}}\)</span> is a counterpart
to <span class="math inline">\(n_w \sigma_{{g_q},{g_w}}\)</span>. If
this is so, then it fells that we should have 3 more inputs for genetic
part, so 4 inputs to estimate 3 unknowns of which some are very simple
transformations!!!</p>
<p>Additional input could be <span class="math inline">\(\sigma^2_{p_c}\)</span>. For sure we don’t get
estimates of <span class="math inline">\(\sigma^2_{p_c} =
\sigma^2_{p_{c,q}} + \sigma^2_{p_{c,w}} +
2\sigma_{p_{c,q},p_{c,w}}\)</span>, but, having sorted the genetic part
and if <span class="math inline">\(B2_p\)</span> and <span class="math inline">\(B3_p\)</span> depend only on genetic covariance,
then maybe, we have some maneuvering space to estimate also <span class="math inline">\(\sigma^2_{p_q}\)</span>, <span class="math inline">\(\sigma^2_{p_w}\)</span>, and <span class="math inline">\(\sigma^2_{{p_q},{p_w}}\)</span>?!</p>
<p>Furthermore, we have some constraints, so this is not just any system
of equations. For example, we know that variances must be positive.
Futhermore, we might know that come covariances are either positive or
negative.</p>
<p>TODO: Develop and polish all this further and create a Shiny
application where we can change these individual-level parameters and
study how that will change colony-level parameters and then how we could
go the other way around based on literature and solving the above
systems of equations. We could host such a Shiny app on SIMplyBee.info!?
Can we?</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jana Obšteter, Laura Strachan, Jernej Bubnič, Gregor Gorjanc.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
